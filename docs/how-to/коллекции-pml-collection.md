---
title: Коллекции PML (Collection)
tags: [collection pml1]
updated: 2025-08-01
level: basic
---

# Collections

Вы можете создать массив, который включает ряд элементов, удовлетворяющих определенным критериям выбора, определенным вами. Это полезный способ сбора информации об определенных элементах. Используется следующий синтаксис:

```pml
VAR !Array COLLECT selection criteria MAX number
```

`!Array` - это имя массива, который будет создан для хранения выбранных элементов.

Для определения выборки можно использовать следующие общие критерии:

- Класс элементов или типы элементов
- Логическое выражение, которое должно выполняться для всех выбранных элементов
- Физический объем, в котором должны находиться все выбранные элементы
- Точка в иерархии, ниже которой должны находиться все выбранные элементы

Все критерии (кроме класса) являются необязательными.

Можно ограничить количество собранных элементов с помощью опции MAX number. Например: MAX 50 соберет только первые 50 элементов, соответствующих заданным критериям.

## Примеры использования

### Базовый сбор элементов

```pml
VAR !PIPECOMPS COLLECT ALL BRANCH MEMBERS
```

Эта команда создаст массив !PIPECOMPS и заполнит его ссылочными номерами каждого трубопроводного компонента в MDB.

### Использование логических выражений

```pml
VAR !LENGTHS COLLECT ALL WITH (XLEN * YLEN * ZLEN GT 1000)
```

Эта команда соберет все элементы, для которых атрибуты XLEN, YLEN и ZLEN соответствуют критериям, в массив !LENGTHS.

### Определение объема

```pml
VAR !VOLUME COLLECT ALL WITHIN W800N17000U0 TO W1400N13500U1200
```

Собирает все элементы в определенном объеме в массив !VOLUME.

```pml
VAR !P COLLECT ALL PIPE EXCLUSIVE WITHIN VOLUME /PUMP1 1500
```

Собирает все компоненты трубопровода в объеме, определенном коробкой, нарисованной на расстоянии 1500 мм вокруг /PUMP1, и помещает их в массив !P.

## Опции HULL DESIGN и HULL PRODUCTION

В Plant есть структурные проектные данные (MODEL) и детальные проектные данные (PRODUCTION). Эти два набора данных представляют одну и ту же модель и занимают одно и то же 3D-пространство. Для объемного запроса вам нужен только один из наборов данных.

Синтаксис команды:

```
>--- VOLUMEOPTION ---+--- HULL DESIGN ---.
                     |                   |
                     |                   |
                     '- HULL PRODUCTION -+--- ON  ---.
                                         |           |
                                         |           |
                                         '--- OFF ---+--->
```

## Иерархические критерии

Иерархические критерии можно определить с помощью ключевого слова FOR. Пример:

```pml
VAR !BRANCH COLLECT ALL BRANCH MEMBERS FOR /PIPE1 /PIPE2 EXCLUDE BRAN 1 OF /PIPE2
```

### Добавление к существующему массиву

```pml
VAR !BENDS APPEND COLLECT ALL ELBOWS
```

Добавит ссылки на все отводы в массив !BENDS.

### Перезапись элементов

```pml
VAR !BENDS[99] COLLECT ALL ELBOWS
```

Поместит ссылку на первый найденный ELBOW в позицию 99 массива !BENDS.

## Оптимизация производительности

При использовании механизма выборки важно учитывать производительность. Вот несколько советов:

1. Ограничивайте область поиска, указывая конкретные классы:
```pml
ENHANCE ALL BOX WITH (XLEN * YLEN * ZLEN GT 1000)
```

2. Явно ограничивайте элементы, которые нужно посетить:
```pml
ENHANCE ALL BOX WITH (XLEN * YLEN * ZLEN GT 1000) FOR /*
```

## Индексированный поиск

Для некоторых атрибутов можно использовать прямой доступ к индексированным значениям:

```pml
VAR !COLL COLLECT ALL FROM TABLE SPRE VALUE /RF300/100G
```

Это вернет все элементы с SPRE, установленным в /RF300/100G.

### Работа с UDA (User Defined Attributes)

Для текстовых UDA:
```pml
VAR !COLL COLLECT ALL for /* FROM TABLE :MYTEXTATT VALUE 'fred'
```

Для целочисленных UDA:
```pml
VAR !COLL COLLECT ALL FROM TABLE :MYATT VALUE 100
```

### Указание базы данных

В версии 12.1 имя БД может быть указано как часть коллекции:

```pml
VAR !COLL COLLECT ALL BOX FOR DB CTBATEST/DESI
```

или

```pml
VAR !COLL COLLECT ALL BOX FOR DB CTBATEST/DESI
VAR !COLL COLLECT ALL WHERE (SITE EQ /ATEST) FOR DB CTBATEST/DESI FROM TABLE SPRE VALUE /RF300/100G
VAR !COLL COLLECT ALL FOR DB CTBATEST/DESI FROM TABLE NAME PREFIX '/B'
```
